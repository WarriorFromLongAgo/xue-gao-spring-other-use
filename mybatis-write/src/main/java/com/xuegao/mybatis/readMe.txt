手写的核心代码